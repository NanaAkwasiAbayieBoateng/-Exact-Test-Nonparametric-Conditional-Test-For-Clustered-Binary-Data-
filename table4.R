


lambda<- function(r,k,d,M) {
  
  M <- sum(apply(d, 2, sum))# sum of all responses in each dose group
  lambda=0
  for (n in r:k){  #k  number of implantation sites with at least 1 response
    
    
    for (j in 0:(n-r)){
      lambda=lambda+ (choose(n-r,j)/choose(n,j))*d[(n+1)-(j),(n)] 
    }
  }
  
  
  
  lambda=as.numeric(format(lambda,digits=15))/M
  return(lambda)
}

rho=function(lambda1,lambda2){
  rho=(lambda2-(lambda1^2))/(lambda1*(1-lambda1))
  return(rho)
}




t0=c(1,0,1,0,1,1,2,1,5,4,6,7,2,2,0,0,0,0,0,0,0)
t1=c(0,0,0,0,1,0,0,0,2,1,7,6,5,2,0,0,1,0,0,0,0)
t2=c(0,0,0,0,0,0,0,0,1,1,5,3,0,1,0,0,1,0,0,0,0)
t3=c(0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0)
t4=c(0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0)
t5=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t6=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t7=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t8=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t9=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t10=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t11=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t12=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t13=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t14=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t15=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t16=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t17=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t18=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t19=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)

d0=rbind(t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19)
colnames(d0)=c("1","2","3","4","5","6","7","8","9","10","11","12","13",
            "14","15","16","17","18","19","20","21")
dim(d0)

c1=d0[,1]
length(c[c>0])

dose_0 <-matrix(c(t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19), nrow=20,byrow=TRUE
                ,dimnames=list(t=c("0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"),
                littersize=c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21")) )

dose_0<- as.table(dose_0)
dim(dose_0)

(lambda11=lambda(1,17,d0,M))
(lambda21=lambda(2,17,d0,M))

(rho21=rho(lambda11,lambda21))


#d30
t0=c(0,1,1,2,0,2,2,1,2,4,8,2,3,2,1,0,0,0,0,0,0)
t1=c(0,0,0,0,0,0,1,1,2,8,4,5,5,2,2,0,0,0,0,0,0)
t2=c(0,0,0,0,0,0,2,2,0,1,1,2,1,2,1,0,0,0,0,0,0)
t3=c(0,0,0,0,0,0,0,0,0,0,1,3,2,0,1,0,0,0,0,0,0)
t4=c(0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0)
t5=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0)
t6=c(0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0)
t7=c(0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0)
t8=c(0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0)
t9=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t10=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t11=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t12=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t13=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t14=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t15=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0)
t16=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t17=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t18=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t19=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)

d30=rbind(t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19)
colnames(d30)=c("1","2","3","4","5","6","7","8","9","10","11","12","13",
                "14","15","16","17","18","19","20","21")
d30

(lambda12=lambda(1,18,d30,M))
(lambda22=lambda(2,18,d30,M))

(rho22=rho(lambda12,lambda22))





#d45
t0=c(1,0,1,1,0,0,1,1,0,1,8,3,0,0,1,0,0,0,0,0,0,0,0)
t1=c(0,0,1,0,1,0,1,1,3,2,4,3,1,1,1,0,0,0,0,0,0,0,0)
t2=c(0,0,0,0,1,1,0,0,1,0,5,4,3,2,1,0,0,0,0,0,0,0,0)
t3=c(0,0,0,0,0,0,0,0,0,0,1,2,3,1,1,1,0,0,0,0,0,0,0)
t4=c(0,0,0,0,0,0,0,0,1,0,0,1,0,2,1,0,0,0,0,0,0,0,0)
t5=c(0,0,0,0,0,0,0,0,0,1,1,1,3,1,1,0,0,0,0,0,0,0,0)
t6=c(0,0,0,0,0,0,0,0,0,1,0,2,0,3,1,1,0,0,0,0,0,0,0)
t7=c(0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0)
t8=c(0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0)
t9=c(0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0)
t10=c(0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0)
t11=c(0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0)
t12=c(0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0)
t13=c(0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0)
t14=c(0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0)
t15=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t16=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t17=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t18=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0)
t19=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t20=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t21=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t22=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)

d45=rbind(t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19,t20,t21,t22)
colnames(d45)=c("1","2","3","4","5","6","7","8","9","10","11","12","13",
                "14","15","16","17","18","19","20","21","22","23")
dim(d45)
(lambda13=lambda(1,21,d45,M))
(lambda23=lambda(2,21,d45,M))

(rho23=rho(lambda13,lambda23))


#d60
t0=c(1,0,0,0,0,0,0,1,0,1,0,3,0,0,1,0,0,0,0,0,0)
t1=c(0,0,0,1,0,0,0,0,2,2,4,2,1,1,0,0,0,0,0,0,0)
t2=c(0,0,0,0,0,0,1,1,1,1,0,0,4,0,1,0,0,0,0,0,0)
t3=c(0,0,2,0,0,0,0,1,0,0,0,0,3,1,0,0,0,0,0,0,0)
t4=c(0,0,0,0,1,0,0,0,1,0,2,0,0,0,0,0,0,0,0,0,0)
t5=c(0,0,0,0,0,2,0,0,0,0,0,2,1,0,0,1,0,0,0,0,0)
t6=c(0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0)
t7=c(0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0)
t8=c(0,0,0,0,0,0,0,2,1,0,0,0,2,0,0,0,0,0,0,0,0)
t9=c(0,0,0,0,0,0,0,0,1,0,2,1,0,0,0,0,0,0,0,0,0)
t10=c(0,0,0,0,0,0,0,0,0,5,1,0,0,0,0,0,0,0,0,0,0)
t11=c(0,0,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0)
t12=c(0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0)
t13=c(0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0)
t14=c(0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0)
t15=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t16=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t17=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t18=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t19=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)

d60=rbind(t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19)
colnames(d60)=c("1","2","3","4","5","6","7","8","9","10","11","12","13",
                "14","15","16","17","18","19","20","21")
d60
(lambda14=lambda(1,16,d60,M))
(lambda24=lambda(2,16,d60,M))

(rho24=rho(lambda14,lambda24))



#d75
t0=c(0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0)
t1=c(0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0)
t2=c(0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0)
t3=c(0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0)
t4=c(0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0)
t5=c(0,0,0,0,2,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0)
t6=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t7=c(0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0)
t8=c(0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0)
t9=c(0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,0,0,0)
t10=c(0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,0)
t11=c(0,0,0,0,0,0,0,0,0,0,4,2,0,0,0,0,0,0,0,0,0)
t12=c(0,0,0,0,0,0,0,0,0,0,0,3,4,0,0,0,0,0,0,0,0)
t13=c(0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0)
t14=c(0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0)
t15=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0)
t16=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t17=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t18=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t19=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)

d75=rbind(t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19)
colnames(d75)=c("1","2","3","4","5","6","7","8","9","10","11","12","13",
                "14","15","16","17","18","19","20","21")
d75
(lambda15=lambda(1,15,d75,M))
(lambda25=lambda(2,15,d75,M))

(rho25=rho(lambda15,lambda25))





#d90
t0=c(0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t1=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t2=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t3=c(0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t4=c(0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0)
t5=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t6=c(0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t7=c(0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t8=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t9=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t10=c(0,0,0,0,0,0,0,0,0,4,2,0,1,0,0,0,0,0,0,0,0)
t11=c(0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0)
t12=c(0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0)
t13=c(0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0)
t14=c(0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0)
t15=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t16=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t17=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t18=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t19=c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)

d90=rbind(t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18,t19)
colnames(d90)=c("1","2","3","4","5","6","7","8","9","10","11","12","13",
                "14","15","16","17","18","19","20","21")
d90
(lambda16=lambda(1,14,d90,M))
(lambda26=lambda(2,14,d90,M))

(rho26=rho(lambda16,lambda26))


newlambda=c(lambda11,lambda12,lambda13,lambda14,lambda15,lambda16)
lambda2=c(lambda21,lambda22,lambda23,lambda24,lambda25,lambda26)
oldlambda=c(0.0691,0.1177,0.2859,0.5058,0.7629,0.9235)
newrho=c(rho21,rho22,rho23,rho24,rho25,rho26)
oldrho=c(-0.0030,0.1250,0.3461,0.5579,0.5482,0.6264)

tab4=cbind(newlambda,oldlambda,newrho,oldrho,lambda2)
rownames(tab4)=c("lambda11","lambda12","lambda13","lambda14","lambda15","lambda16")
tab4

(lambda31=lambda(3,17,d0,M))
(lambda32=lambda(3,18,d30,M))
(lambda33=lambda(3,21,d45,M))
(lambda34=lambda(3,16,d60,M))
(lambda35=lambda(3,15,d75,M))
(lambda36=lambda(3,14,d90,M))

lambda3=c(lambda31,lambda32,lambda33,lambda34,lambda35,lambda36)



(lambda41=lambda(4,17,d0,M))
(lambda42=lambda(4,18,d30,M))
(lambda43=lambda(4,21,d45,M))
(lambda44=lambda(4,16,d60,M))
(lambda45=lambda(4,15,d75,M))
(lambda46=lambda(4,14,d90,M))

lambda4=c(lambda41,lambda42,lambda43,lambda44,lambda45,lambda46)


(lambda51=lambda(5,17,d0,M))
(lambda52=lambda(5,18,d30,M))
(lambda53=lambda(5,21,d45,M))
(lambda54=lambda(5,16,d60,M))
(lambda55=lambda(5,15,d75,M))
(lambda56=lambda(5,14,d90,M))

lambda5=c(lambda51,lambda52,lambda53,lambda54,lambda55,lambda56)

(lambda61=lambda(6,17,d0,M))
(lambda62=lambda(6,18,d30,M))
(lambda63=lambda(6,21,d45,M))
(lambda64=lambda(6,16,d60,M))
(lambda65=lambda(6,15,d75,M))
(lambda66=lambda(6,14,d90,M))

lambda6=c(lambda61,lambda62,lambda63,lambda64,lambda65,lambda66)

(lambda71=lambda(7,17,d0,M))
(lambda72=lambda(7,18,d30,M))
(lambda73=lambda(7,21,d45,M))
(lambda74=lambda(7,16,d60,M))
(lambda75=lambda(7,15,d75,M))
(lambda76=lambda(7,14,d90,M))

lambda7=c(lambda71,lambda72,lambda73,lambda74,lambda75,lambda76)


(lambda81=lambda(8,17,d0,M))
(lambda82=lambda(8,18,d30,M))
(lambda83=lambda(8,21,d45,M))
(lambda84=lambda(8,16,d60,M))
(lambda85=lambda(8,15,d75,M))
(lambda86=lambda(8,14,d90,M))

lambda8=c(lambda81,lambda82,lambda83,lambda84,lambda85,lambda86)


(lambda91=lambda(9,17,d0,M))
(lambda92=lambda(9,18,d30,M))
(lambda93=lambda(9,21,d45,M))
(lambda94=lambda(9,16,d60,M))
(lambda95=lambda(9,15,d75,M))
(lambda96=lambda(9,14,d90,M))

lambda9=c(lambda91,lambda92,lambda93,lambda94,lambda95,lambda96)


(lambda101=lambda(10,17,d0,M))
(lambda102=lambda(10,18,d30,M))
(lambda103=lambda(10,21,d45,M))
(lambda104=lambda(10,16,d60,M))
(lambda105=lambda(10,15,d75,M))
(lambda106=lambda(10,14,d90,M))

lambda10=c(lambda101,lambda102,lambda103,lambda104,lambda105,lambda106)

tab5=rbind(newlambda,lambda2,lambda3,lambda4,lambda5,lambda6,lambda7,lambda8,lambda9,lambda10)
rownames(tab5)=c("lambda1","lambda2","lambda3","lambda4","lambda5","lambda6","lambda7","lambda8","lambda9","lambda10")
colnames(tab5)=c("dose 0 mg","dose 30 mg","dose 45 mg","dose 60 mg","dose 75 mg","dose 90 mg")
tab5

dose=c(1,2,3,4,5,6)
#plot(dose,newlambda,lambda2)

par(mfrow=c(2,1))
matplot(tab5,axes=T,frame=T,type='l',ylab="probability",xlab="Dose level",lwd=2, lty=1:10)
#legend(10, 1,c('newlambda','lambda2','lambda3','lambda4','lambda5','lambda6','lambda7','lambda8','lambda9','lambda10'), pch=c(1:10)) )



matplot(tab4,axes=T,frame=T,type='l',ylab="probability",xlab="Dose level",lwd=2, lty=1:6) 

